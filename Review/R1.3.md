# PCB Design Review Report

Generated: 2/10/2026, 4:32:11 PM

## PCB Description

This is a board to turn on when is night, and power 3 led in series, they are powered from a constant current led driver configured for 60mA (3.3Ohm via 3 10Ohm in paralle), turned on by the comparator which has a trimmer and a luminosity sensor.

## Board Summary

- **Layers**: 2
- **Components**: 29
- **Nets**: 24
- **Traces**: 137
- **Vias**: 28
- **Schematic Sheets**: 1

## Table of Contents

1. [General Review](#general-review)
2. [Power Architecture](#power-architecture)

## General Review {#general-review}

## Executive Summary
Compact 2‑layer LED lighting board powered from USB‑C (VBUS 5 V), boosting to drive three LEDs in series at ~60 mA, enabled by an LM393 night/day comparator. Overall concept and topology are sound, but there are several power-stage and protection details that should be corrected to ensure reliability and stable current regulation.

## Strengths
- Appropriate topology for 3‑LED series string from 5 V using a boost LED driver; sense resistor implemented as 3×10 Ω in parallel for low dissipation and availability.
- USB‑C used correctly as a 5 V source with CC pull‑downs; no unnecessary high‑speed routing.
- DFM-friendly: 2‑layer, min trace width 0.2 mm, 0.3 mm drills, no via‑in‑pad; should build easily at JLCPCB/PCBWay standards.
- Comparator network includes hysteresis path and an adjustment potentiometer for threshold tuning.
- Ground pour on one layer and reasonable decoupling presence on 5 V and LED output nodes.

## Issues Found
### Critical (must fix before fabrication)
- OVP divider likely set far too high:
  - The OVP divider (top ≈300 k, bottom ≈6.2 k) will trip near ~50–60 V for a typical ~1.2 V OVP threshold, far above the ~10–12 V needed for 3 LEDs. This risks overstress to LEDs, diode, and output capacitors during startup/faults.
  - Action: Recalculate to target ~12–14 V OVP. Example: Rbottom = 6.2 k, Rtop = 56–68 k (verify with the LED driver’s OVP threshold spec).
- Inductor choice/footprint unsuitable for a switching power stage:
  - L1 is an 0805 chip inductor; these are typically RF parts with low Isat and high DCR, not power inductors. For a 5 V→~11 V/60 mA boost, average inductor current ~0.15 A and startup/transients demand higher peak current; 0805 parts are likely to saturate.
  - Action: Use a shielded power inductor (e.g., 3×3 mm or 4×4 mm) with low DCR and Isat ≥0.5 A (preferably ≥0.8–1 A for margin) and verify inductance at bias current per the driver datasheet.
- Feedback/sense routing risk (long FB return through LED string):
  - The LED cathode returns to the driver FB via a long path; noise pickup and ground bounce can destabilize current regulation.
  - Action: Implement a Kelvin connection to the sense resistors at the driver, keep FB loop short, and route the LED return separately to the sense node (star point).
- Output capacitor voltage rating margin:
  - Output node will be ~10–12 V nominal. With the current OVP error, transient voltages may significantly exceed this.
  - Action: Ensure C2/C3 are rated ≥25 V (preferably 35–50 V if OVP is not tightly controlled), X5R/X7R dielectric, and placed to minimize the boost output loop.

### Warnings (should consider fixing)
- Switch-loop layout and decoupling:
  - Ensure the high di/dt loop (IC SW → diode → output cap → IC GND) is as tight as possible. C2/C3 should be placed close to the diode and the driver’s return. Add an input 100 nF ceramic right at the driver VIN pin (in addition to 4.7 µF bulk).
- EN/control network clarity:
  - R12 value is ambiguous (listed by supplier code). If it’s a 0 Ω link, fine; if not, verify the EN pin sees the correct logic and that the LM393 (open-collector) can actively pull EN to the intended state. Consider a defined pull-down/up at EN so the default state is known when the comparator is unpowered or the jumper is open.
- Comparator input network:
  - R10 appears in parallel with the LDR to ground; confirm this is intentional. Using very large values (2 M) for hysteresis resistors is okay but can be noise-prone; consider lowering the network impedance and/or adding a small RC filter to avoid flicker around threshold.
- USB‑C power robustness:
  - Add input protection: a resettable fuse (polyfuse) and a 5 V TVS diode on VBUS can improve survivability against shorts and ESD. Ensure the connector shield is appropriately tied to ground (direct or via RC) for ESD performance.
- Excess vias on LED series nets:
  - “Pad1/Pad2” have many vias; reduce where possible to improve reliability and voltage headroom, and to lower parasitics.
- Ground strategy:
  - Only one ground pour is visible; adding a top-layer ground pour tied with stitching vias (especially around the driver, diode, and inductor) will reduce EMI and loop impedance.

### Suggestions (nice to have)
- Thermal for LEDs:
  - Provide ample copper under each LED footprint (and thermal vias to the opposite ground pour) to spread ~0.15–0.2 W per LED; improves lifetime and brightness stability.
- Labeling and test points:
  - Add test pads for: 5 V, GND, EN, LED+ (boost output), FB. Clearly mark LED polarity and the potentiometer’s adjust direction.
- BOM clarity:
  - Replace supplier codes in “value” fields with actual electrical values (Ω, %) and voltage ratings (for capacitors) to avoid assembly ambiguity.
- EMI/ringing control:
  - If you observe switch-node ringing, consider a small RC snubber from SW (driver node) to ground and keep the SW trace short and away from FB.

## Design Metrics
| Metric | Value | Notes |
|-------|-------|-------|
| Complexity Score | 3/10 | Single boost stage, simple comparator control |
| Manufacturing Risk | Medium | Power inductor choice/layout and OVP setting are current risks |
| Estimated Layer Count Needed | 2 layers | Adequate with good placement and stitching |
| Min Trace Width | 0.20 mm | Within JLC/PCBWay standard (no issue) |
| Min Via Drill | 0.30 mm | Cost-effective and robust |
| Total Vias | 28 | Acceptable; could reduce on LED nets |
| Peak LED Current | 60 mA (series) | Trace width OK; keep LED paths short |

## Questions for Designer
- What is the exact LED driver (LGS63030) datasheet OVP threshold and FB reference voltage? I will recompute OVP and sense resistor values precisely with those specs.
- What is the intended nominal LED string voltage at 60 mA (per LED forward voltage)? This confirms OVP target and inductor current margins.
- What is the actual value of R12 (series to EN)? Is it 0 Ω or a finite resistor? What default EN state is desired on power-up?
- What are the exact values of R10/R11 (those marked by supplier codes)? This is needed to verify the comparator threshold and hysteresis depth with the LDR.
- Are output capacitors C2/C3 specified for at least 25 V (preferably higher)? If not, what ratings are you planning?
- Can we change the inductor footprint to a proper power inductor (e.g., 3×3 mm or 4×4 mm shielded) with Isat ≥0.5–1 A? If space-constrained, what is the maximum allowable footprint?
- Do you want input protection (polyfuse/TVS) and/or ESD strategy for the USB‑C connector shell-to-ground connection?

---

## Power Architecture {#power-architecture}

## Summary
Overall architecture is a simple 5 V input feeding a boost constant‑current LED driver that generates a higher VLED rail for a 3‑LED series string, with an LM393 comparator enabling the driver at night. Power levels are low (~60 mA LED current), so capacity and thermals are generally benign; the main concerns are switch‑loop layout/EMI and ensuring the 0805 inductor and diode ratings comfortably exceed peak currents.

## Power Architecture Overview
5 V (J1) → Boost LED driver (U1) → VLED (Net-(D1-K)) → LED string (3s, 60 mA)
                 ↘ LM393 comparator (U5) provides EN/CTRL (“NightHigh”)

## Power Rails Identified
| Rail Name | Type | Connected Components | Via Count |
|-----------|------|---------------------|-----------|
| 5V | Input | J1, U1 (driver VIN), U5 (LM393 VCC), L1, C1, C23 | n/a |
| VLED (Net-(D1-K)) | Regulated (boosted) | LED string load, U1 LED output sense, D1 cathode, C2, C3 | n/a |
| SW (Net-(D1-A)) | Switching node (noisy) | U1 SW, L1, D1 anode | n/a |
| GND | Ground | All returns incl. U1, U5, C1–C3, C23, LEDs, J1 | 6 |

## Voltage Regulators
| Reference | Type | Input | Output | Connected Load |
|-----------|-------|-------|--------|----------------|
| U1 | LED boost constant‑current driver (inferred) | 5V | VLED (Net-(D1-K)) | 3‑LED series string @ 60 mA |

## Decoupling Analysis
- Total capacitors: 4
- ICs requiring decoupling: 2 (U1 driver, U5 comparator)
- Ratio: 2.0 (target: 2–4 caps per IC minimum)

Observations:
- 5 V rail: C1 (bulk, 4.7 µF) and C23 (likely 100 nF) provide bulk + HF decoupling; ensure both are tight to U1 VIN and U5 VCC pins.
- VLED: C2 + C3 (both 4.7 µF) provide output bulk; good for LED ripple and stability. Consider adding a small 100 nF directly from D1 cathode to GND if layout is long to shunt HF switching edges.
- Place U5’s 100 nF (C23) within a few millimeters of VCC/GND pins; route GND to the quiet ground (away from SW current pulses).

## Current Capacity Estimate
| Net | Via Count | Est. Capacity | Risk Level |
|-----|-----------|---------------|------------|
| 5V | n/a | Easily supports >200 mA with ≥10 mil traces on 1 oz; far above required ~130 mA input avg | Low |
| VLED | n/a | 60 mA DC; ≥10 mil trace adequate; keep away from sensor lines | Low |
| SW | n/a | Peak inductor/diode current; keep short/wide; minimize loop area | Medium (EMI) |
| GND | 6 | Multiple returns available; use solid pours both sides to lower impedance | Low |

Notes:
- At ~9–10 V LED headroom, input average current ≈ 0.12–0.14 A (assuming ~85% eff). Standard 5–10 mil traces on 1 oz copper are sufficient; wider is better for reduced IR ripple.

## Thermal Analysis
| Component | Thermal Vias | Assessment |
|-----------|--------------|------------|
| U1 (LED driver) | n/a | Low dissipation at 60 mA; provide local copper pour tied to GND/VIN as recommended in datasheet for heat spreading. |
| D1 (Schottky) | n/a | Low average loss but pulsed; ensure Vf and IF(AV) margin; add copper for cooling and EMI return. |
| L1 (4.7 µH, 0805) | n/a | Check Isat > Ipk; provide copper around pads for heat; keep away from sensor nodes. |
| LM393 (U5) | n/a | Negligible dissipation; prioritize clean ground reference over thermal relief. |

## Issues and Recommendations
### Critical
- Minimize the switch current loop: VIN cap (C1) → U1 SW → D1 → output cap (C2/C3) → GND return back to C1. Keep this loop on one layer with the smallest area possible; place C1, D1, and C2/C3 tight to U1.
- Keep SW node (Net-(D1-A)) copper short, wide, and away from comparator inputs, trimmer, and sensor traces. Do not pour copper on SW beyond what’s needed.

### Warnings
- Inductor rating: Verify L1 Isat and Irms. For a boost at 60 mA out and Vout ≈ 9–10 V from 5 V in, IIN(avg) ≈ 0.12–0.14 A. Peak inductor current Ipk ≈ IIN(avg) + ΔIL/2, where ΔIL = (VIN · D)/(L · fSW). Choose L1 with Isat comfortably above Ipk (≥2× margin recommended if 0805 part is low‑Isat).
- Diode rating: Use a low‑Qrr Schottky with IF(AV) ≥ 0.5 A margin and adequate VR for VLED; check power dissipation and thermals.

### Suggestions
- Grounding: Use solid GND pours on both layers; stitch with vias near input/output caps, driver GND, and diode return. Keep comparator/sensor ground separate from power return until a single star point near U1 GND.
- Add a small HF bypass (e.g., 100 nF) at VLED (D1 cathode to GND) close to D1/C2/C3 if diode‑to‑cap distance exceeds a few millimeters.
- EMI refinement (optional): If emissions or ripple are an issue, consider an RC snubber from SW to GND or a series resistor in D1 to tune ringing; validate via scope.
- Comparator decoupling: Ensure C23 is as close as possible to U5; route its ground directly to the quiet ground node, not through the switch current return.
- Trace/via implementation: For power paths (5 V, VLED, SW) use ≥10–20 mil traces where space allows; use ≥0.3 mm drills for general vias. These are well within JLCPCB/PCBWay standard capabilities.
- Testability: Add test pads for 5 V, VLED, GND, and EN/CTRL for bring‑up and scope probing.

---
