# PCB Design Review Report

Generated: 2/10/2026, 4:17:49 PM

## PCB Description

This is a board to turn on when is night, and power 3 led, each one absorb 60mA, they are powered from a constant current led driver, turned on by the comparator which has a trimmer and a luminosity sensor.

## Board Summary

- **Layers**: 2
- **Components**: 24
- **Nets**: 22
- **Traces**: 110
- **Vias**: 25
- **Schematic Sheets**: 1

## Table of Contents

1. [General Review](#general-review)
2. [Power Architecture](#power-architecture)

## General Review {#general-review}

## Executive Summary
Compact 2-layer USB‑C powered, night-activated LED driver board using a boost constant-current LED driver (SOT‑23‑6) to run a series string of 3 LEDs at about 60 mA. An LM393 comparator with an LDR and trim pot generates the enable signal for the LED driver. Overall architecture is sound, but a few electrical and layout issues could compromise reliability, EMI, and robustness.

## Strengths
- Clean functional partitioning: USB‑C power entry with CC resistors, boost LED driver stage, and comparator-based light detection/enable.
- Constant-current setpoint implemented sensibly (three 10 Ω in parallel ≈ 3.33 Ω aligns with ~60 mA for a typical 0.2 V FB reference).
- Output and input bulk caps included; backflow protection/rectification via SS14; reasonable via sizes and trace widths for current levels.
- Fabrication parameters (min width 0.2 mm, 0.3 mm drills, 2-layer) are within standard capabilities of JLCPCB/PCBWay.

## Issues Found

### Critical (must fix before fabrication)
- Inductor footprint/current rating risk:
  - L1 is a 0603 4.7 µH. For ~60 mA LED current and ~11–12 V output from 5 V in, the inductor peak/avg currents will likely exceed what most 0603 inductors can handle (Isat and Irms), with high DCR losses. Select a power inductor sized at least 2×2 mm (preferably 3×3 mm) with Isat ≥ 1 A and low DCR (<150 mΩ), per the LED driver’s datasheet.
- Over-voltage protection (OVP) divider likely far too high:
  - 300 kΩ / 6.2 kΩ sets an OVP threshold on the order of 50–60 V (assuming ~1.2–1.25 V OVP ref), which risks overstress of the SS14 (40 V VR) and caps during open-LED faults. Retarget OVP ≈ 15–20 V. Example: for 15 V and 1.25 V OVP ref, use ~68 kΩ top with 6.2 kΩ bottom (verify against the exact IC datasheet Vovp).
- Comparator output/EN robustness:
  - LM393 is open-collector and requires a defined pull-up to a valid logic level. EN currently depends on a solder-jumper path and R6; without a guaranteed pull-up, EN can float. Add a dedicated pull-up (e.g., 100 kΩ) to 5 V on EN or ensure LM393 output includes a pull-up to the EN logic high level (and consider inversion needs).
- High di/dt loop layout for boost stage:
  - The switch node → diode → output cap → return loop appears spatially stretched (D1 and output caps far from the IC). This will increase EMI and switching noise. Place SS14 and the output capacitors immediately adjacent to the switch node and ground return, minimizing loop area; keep the sense/FB away from the switch node.

### Warnings (should consider fixing)
- Add local high-frequency decoupling:
  - Place 100 nF ceramic close to U1 (VIN) and to U5 (VCC) in addition to existing 4.7 µF bulk caps.
- Output capacitor voltage rating/derating:
  - Ensure C2/C3 have ≥25 V rating (X5R/X7R) and sufficient effective capacitance at bias for the target LED+ voltage (≈12–15 V). 0805 4.7 µF often derates significantly at DC bias.
- Hysteresis for light threshold:
  - The LM393 night/day threshold may chatter near the boundary. Add positive feedback (e.g., 470 k–1 MΩ from comparator output to the LDR node or reference node) to introduce hysteresis and prevent flicker.
- USB‑C power entry protection:
  - Add a low-capacitance TVS on VBUS (5 V) and ESD protection on CC pins. Consider a resettable fuse or current limiter on VBUS for fault conditions.
- LED string routing/vias:
  - Pad1/Pad2 nets have many vias. While 60 mA is low, reduce via count and path length where possible to lower voltage drop and improve reliability.
- Sense network noise immunity:
  - Route FB as a quiet, short trace from the LED return/sense resistors to the IC. Consider an RC filter if recommended by the driver datasheet (e.g., 100 nF from FB to GND and a small series R if specified).
- Mixed package sizes and value fields:
  - Several resistors use distributor codes as “value” (e.g., C25764, C25905). Replace with ohmic values in the Value field and move supplier codes to BOM fields to avoid assembly ambiguity. Also review if R12 must be 1206 versus surrounding 0603/0402 for consistency.
- Grounding and stitching:
  - Add more GND stitching vias around the boost power loop and near the output caps/diode to provide a low-impedance return and reduce radiated EMI.

### Suggestions (nice to have)
- Testability and bring-up:
  - Add labeled test points for EN, LED+, FB, OVP, VBUS, and GND.
- Thermal considerations:
  - Provide copper pours/thermal relief near the SS14 and the inductor footprint to improve heat spreading.
- Documentation/marking:
  - Ensure LED polarity/orientation marks are unambiguous; consider silkscreen notes for the jumper function and trim pot direction.
- Mechanical:
  - If USB-C is board-edge mounted, verify mechanical support and keepouts; consider two mounting holes for strain relief and installation.

## Power Architecture

| Rail | Net | Source | Primary Loads | Notes |
|------|-----|--------|---------------|-------|
| 5 V | 5V | USB‑C VBUS via J1 | U1 VIN, LM393 VCC, pull-ups, EN network | Add 100 nF near U1 and U5; consider input TVS/PTC. |
| LED+ (boost out) | Net-(D1-K) | U1 via L1 (switch) and SS14 | LED string input, output caps C2/C3, OVP divider | Set OVP ≈ 15–20 V; move C2/C3 close to D1/ground. |
| Switch node | Net-(D1-A) | U1 SW, L1 | D1 anode | Keep compact; short, wide trace; avoid FB proximity. |
| LED return / sense | Net-(U1-FB) to R3–R5 to GND | LED string output | U1 FB pin | Quiet routing; possible small RC per datasheet. |

Decoupling adequacy:
- Input: 4.7 µF present; add 100 nF close to U1 VIN.
- Comparator: add 100 nF close to U5 VCC.
- Output: Two 4.7 µF on LED+; verify voltage rating and move physically closer to D1 and GND return.

Regulator/driver choices:
- U1 (LGS63030) assumed boost LED driver; confirm datasheet to validate FB ref, OVP ref, inductor spec, and recommended comp/RC networks.
- U5 is LM393 (comparator), not a regulator; ensure proper pull-ups and hysteresis.

## Signal Integrity

| Net | Purpose | Approx Length | Vias | SI Note |
|-----|---------|---------------|------|---------|
| Net-(D1-K) | LED+ (boost output) | Long | Low | Keep short/wide near power loop; place C2/C3 close. |
| Net-(U1-FB) | LED sense | Moderate | 0 | Keep away from switch node; consider RC filter if needed. |
| Pad1/Pad2 | LED interconnect | Short | High | Reduce via count; minor drop at 60 mA but cleaner routing preferred. |
| 5V | Input power | Moderate | Few | Use wider traces to/from L1 and U1 VIN. |

No differential pairs or high-speed signals. Main SI/EMI concern is the boost switching loop (SW–D1–Cout–GND). Minimize that loop area and keep FB quiet.

## Manufacturing Considerations

| Item | Observed | Capability Ref | Status |
|------|----------|----------------|--------|
| Min trace width | 0.2 mm (7.9 mil) | ≥0.127 mm (2‑L) | OK |
| Min spacing | ≥0.2 mm (assumed) | ≥0.127 mm (2‑L) | OK |
| Via drill | 0.3 mm | ≥0.15 mm (std), 0.3 mm recommended | Optimal |
| Layers | 2 | Standard | OK |
| Via-in-pad | None | N/A | OK |
| Smallest parts | 0402 | Standard assembly | OK (harder for hand-solder) |

Layer usage:
- Heavy use on F.Cu with B.Cu ground pour. Add more GND stitching vias near the power stage and LEDs to improve return paths and EMI.

## Cross-Reference Issues
- No schematic/PCB mismatches reported.
- Value fields using supplier part numbers (e.g., C25764, C25905) can confuse assembly and reviews—replace with actual values (e.g., 100 kΩ, 5.1 kΩ) and keep supplier codes in dedicated BOM fields.

## Design Metrics
- Complexity Score: 4/10
- Manufacturing Risk: Medium (due to inductor footprint/spec risk, EMI risk from layout, and comparator/EN robustness)
- Estimated Layer Count Needed: 2 layers

## Questions for Designer
- Please share the LGS63030 datasheet or confirm:
  - FB reference voltage and OVP reference voltage (to precisely set R3–R5 total and R1/R2).
  - Recommended inductor value/current rating and any compensation/RC networks on FB/OVP.
- What is the expected LED forward voltage at 60 mA (each, worst case)? Target OVP (e.g., 15–18 V)?
- Should EN be active-high or active-low relative to the LM393 output? How do you intend EN to default if the jumper is open? Can we add a fixed pull-up on EN?
- Do you want hysteresis on the light threshold to avoid flicker near dusk/dawn? If so, preferred width (e.g., ±5–10%)?
- Are C2/C3 rated ≥25 V and with suitable dielectric (X5R/X7R) at operating bias? Any size constraints if we upsize to 1206 for better bias performance?
- Is ESD/TVS on VBUS and CC lines desired for USB‑C robustness? Any inrush limiting or protection requirements?
- Any mechanical constraints around the USB‑C receptacle (board edge, keepouts, mounting holes) and the THT potentiometer?

---

## Power Architecture {#power-architecture}

## Summary
Simple 5 V–in, LED-driver–out architecture with a comparator-controlled enable looks reasonable for ~180 mA total LED current. Main gaps are in decoupling (insufficient and no small-value caps), potential inductor saturation (0603 at this current is risky), and unclear input (USB‑C) power negotiation. Ground stitching and power distribution details appear light for a switching LED driver.

## Power Architecture Overview
5 V (USB-C J1) → LED driver U1 (buck topology) → LED rail (Net-(D1-K)) → LED(s)  
                                 ↘ LM393 comparator U5 (enable/control via NightHigh/Trim)

## Power Rails Identified
| Rail Name | Type | Connected Components | Via Count |
|-----------|------|---------------------|-----------|
| 5V | Input | J1 (VBUS, implied), C1 (4.7 µF), U5 (LM393), L1 (to SW), U1 (LED driver, implied) | n/a |
| Net-(D1-K) | Regulated (LED OUT) | C2 (4.7 µF), C3 (4.7 µF), D1, LEDs/load | n/a |
| Net-(D1-A) | Switching node (SW) | L1 (from 5 V), D1 | n/a |
| GND | Ground | Many (C1–C3, J1, R2–R5, R7–R9, RV1, U1, U5) | 3 |

## Voltage Regulators
| Reference | Type | Input | Output | Connected Load |
|-----------|------|-------|--------|----------------|
| U1 (not listed in powerComponents) | LED driver (likely buck CC) | 5V | Net-(D1-K) | LED string(s), 3 × 60 mA total ≈ 180 mA |
| U5 (LM393) | Comparator (control, not a regulator) | 5V | NightHigh/Enable | Gates U1 enable via sensor/trim |

## Decoupling Analysis
- Total capacitors: 3
- ICs requiring decoupling: 2+ (U1 LED driver, U5 comparator)
- Ratio: 1.5 (target: 2-4 caps per IC minimum)

Observations:
- Only one 4.7 µF on 5 V (C1) — light for a switching LED driver
- Two 4.7 µF on LED OUT — may be below/above optimal depending on driver datasheet, and no 100 nF local decouplers are shown
- No explicit 100 nF near LM393 or near U1 VIN

## Current Capacity Estimate
| Net | Via Count | Est. Capacity | Risk Level |
|-----|-----------|---------------|------------|
| 5V | n/a | If single 0.3 mm drill via: ~0.5–1 A each (1 oz ext) | Medium (unknown via count/width) |
| Net-(D1-K) (LED OUT) | n/a | Similar; needs low-ESR path for ~0.18 A DC + ripple | Medium (unknown via count/width) |
| Net-(D1-A) (SW) | n/a | Pulsed; focus on short, wide traces and tiny loop area | Medium (EMI/efficiency risk if long/narrow) |
| GND | 3 | ~1.5–3 A total (if 3 × 0.3 mm vias) | Low–Medium (layout dependent) |

Notes:
- 180 mA average LED current is modest, but switching ripple current and loop geometry dominate performance.
- If vias are <0.2 mm drills, derate capacity significantly; use multiple vias for all high-current returns.

## Thermal Analysis
| Component | Thermal Vias | Assessment |
|-----------|--------------|------------|
| U1 LED driver (implied) | n/a | Provide copper pour under/around IC and SW path; add 3–6 thermal vias if exposed pad package. 180 mA switching dissipation is small but layout critical. |
| L1 (0603, 4.7 µH) | n/a | 0603 often saturates near 200–300 mA; select Isat ≥ 0.6–1 A and low DCR to limit heating. Consider 0805/1210 package. |
| D1 (Schottky) | n/a | Choose low-Vf Schottky rated ≥ 0.5–1 A and appropriate thermal copper for pulse current. |
| U5 (LM393, SOIC-8) | n/a | Minimal thermal concern; ensure proper decoupling to avoid oscillation. |

## Issues and Recommendations
### Critical
- Inductor headroom: 0603 4.7 µH is likely marginal for 180 mA LED current with ripple; select an inductor with Isat ≥ 0.6–1 A and Irms ≥ 0.3–0.5 A, preferably 0805/1210 with low DCR.
- Decoupling missing: Add 100 nF close to U5 VCC and to U1 VIN. Increase input bulk near U1 (10–22 µF low-ESR ceramic) placed to minimize loop with U1/D1/L1.
- USB-C power negotiation: If J1 is USB-C used only for power, ensure two Rd pull-down resistors on CC1/CC2 so sources reliably provide 5 V default current.

### Warnings
- GND integrity: Only 3 vias reported on GND; for a switching driver, add ground pours on both layers with frequent stitching vias near U1, D1, L1, and the input/output capacitors.
- Output capacitor sizing/ESR: Two 4.7 µF may not match the LED driver’s stability requirements. Verify value and ESR per the driver datasheet (often 10–47 µF total, X5R/X7R, 6.3–10 V).
- Diode/LED path current: Ensure D1 and LED return traces are short and ≥0.5 mm wide; avoid routing SW node under sensitive analog (LM393 inputs, trim network).

### Suggestions
- Power distribution
  - Use ≥0.5–1.0 mm wide traces for 5 V and LED OUT nets where space allows; keep SW node as short/wide as possible and confined to one layer.
  - Place C1 and the added input cap adjacent to U1 VIN and diode/inductor junction to minimize the hot loop.
  - Use multiple 0.3 mm drill vias for any layer transitions on 5 V, LED OUT, and GND (2–4 vias per transition).
- Comparator stability: Add a local 100 nF + optional 1–4.7 µF at LM393 VCC–GND; consider input hysteresis if not already present to avoid flicker near threshold.
- LED topology: If LEDs are in parallel, add small ballast resistors per LED or use separate current regulators to prevent current hogging. If in series, ensure total Vf < available compliance.
- Component ratings: Choose D1 Schottky with ≥1 A Ifsm, low Vf; ensure sense resistor and any LED series resistors have adequate power rating.
- EMI: Keep a solid ground reference under the comparator and sensor network; keep the SW node copper minimal and away from signal nets; consider a small RC snubber if ringing is observed.

---
